<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>IPSS Self-Assessment — by Anurag Pande</title>
<meta name="description" content="Quick, phone-friendly IPSS self-check with instant score and email capture.">
<style>
  :root { --sky:#0ea5e9; --emerald:#10b981; --amber:#f59e0b; --rose:#ef4444; --ink:#0b1322; }
  * { box-sizing:border-box; }
  body { margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:#0f172a;
         background:radial-gradient(ellipse at top,#f0f9ff,#fff); }
  .container { max-width:980px; margin:0 auto; padding:20px; }
  .hero { display:flex; gap:12px; align-items:center; margin:6px 0 8px; }
  .logo { width:40px;height:40px;border-radius:14px;background:var(--sky);
          display:grid;place-items:center;color:#fff; }
  .muted { color:#64748b; font-size:13px; }
  .card { background:#fff; border:1px solid #e2e8f0; border-radius:16px; box-shadow:0 6px 18px rgba(2,6,23,.06); }
  .card-h { padding:14px 16px; border-bottom:1px solid #eef2f7; font-weight:600; }
  .card-b { padding:12px 14px; }
  .stack { display:grid; gap:14px; }
  .q { padding:12px; border:1px solid #e2e8f0; border-radius:12px; }
  .q legend { font-weight:600; margin-bottom:6px; }
  .optrow { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  @media (min-width:640px){ .optrow { grid-template-columns:repeat(3,1fr);} }
  .pill { display:flex; align-items:center; gap:8px; padding:10px; border:1px solid #cbd5e1; border-radius:12px;
          background:#fff; cursor:pointer; user-select:none; }
  .pill input { appearance:none; width:18px; height:18px; border:2px solid #94a3b8; border-radius:50%; display:inline-block; }
  .pill input:checked { border-color:var(--sky); box-shadow:inset 0 0 0 4px var(--sky); }
  .pill:has(input:checked) { border-color:var(--sky); background:#f0f9ff; }
  .row2 { display:grid; gap:12px; grid-template-columns:1fr; }
  @media (min-width:640px){ .row2 { grid-template-columns:1fr 1fr; } }
  input[type="text"], input[type="email"], input[type="number"] {
    width:100%; height:42px; border:1px solid #cbd5e1; border-radius:10px; padding:0 12px; outline:none;
  }
  input:focus { border-color:var(--sky); box-shadow:0 0 0 3px rgba(14,165,233,.2); }
  button { height:46px; padding:0 16px; border-radius:12px; background:var(--sky); color:#fff; border:none; font-weight:700; }
  button[disabled]{ background:#cbd5e1; }
  .msg{ margin-top:8px; font-size:14px; display:flex; align-items:center; gap:8px; }
  .ok{ color:#166534; } .err{ color:#b91c1c; }

  /* Layout: phone-first */
  .layout { display:grid; gap:16px; }
  @media (min-width:900px){ .layout { grid-template-columns:1.4fr .9fr; } }

  /* Gauge */
  .gauge { width:180px; height:180px; }
  .g-bg { stroke:#e2e8f0; fill:none; stroke-width:14; }
  .g-fg { stroke:var(--sky); fill:none; stroke-width:14; stroke-linecap:round; transform:rotate(-90deg); transform-origin:50% 50%;
          transition:stroke-dashoffset .4s ease; }
  .score { font-weight:800; font-size:42px; }
  .badge { display:inline-flex; align-items:center; gap:6px; padding:5px 10px; border-radius:999px; color:#fff; font-size:12px; font-weight:700; }
  .b-emerald{ background:var(--emerald); } .b-amber{ background:var(--amber); } .b-rose{ background:var(--rose); }

  footer { border-top:1px solid #e2e8f0; background:#fff; margin-top:20px; }
  footer .inner{ max-width:980px; margin:0 auto; padding:10px 20px; font-size:12px; color:#64748b; display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px;}
</style>
</head>
<body>
  <div class="container">
    <div class="hero">
      <div class="logo" aria-hidden="true">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 3v18h18"/><path d="M7 13h3v8H7zM12 8h3v13h-3zM17 5h3v16h-3z"/>
        </svg>
      </div>
      <div>
        <h1 style="margin:0;font-size:24px;">IPSS Self-Assessment</h1>
        <div class="muted">by Anurag Pande</div>
      </div>
    </div>
    <p class="muted" style="max-width:740px;margin:6px 0 16px;">
      Over the <strong>past month</strong>, choose the option that best describes your urinary symptoms. Results are informational only and not a diagnosis.
    </p>

    <div class="layout">
      <!-- FORM -->
      <div class="card">
        <div class="card-h">Questionnaire</div>
        <div class="card-b">
          <form id="ipssForm" class="stack">
            <div class="row2">
              <div>
                <label for="name">Name <span style="color:#ef4444">*</span></label>
                <input id="name" name="name" placeholder="Your full name" required>
              </div>
              <div>
                <label for="email">Email <span style="color:#ef4444">*</span></label>
                <input id="email" name="email" type="email" placeholder="you@example.com" required>
                <div class="muted">Email is required to receive your results/education.</div>
              </div>
            </div>

            <!-- Q1 -->
            <fieldset class="q">
              <legend>1) Over the past month, how often have you had the <strong>sensation of not emptying your bladder completely</strong> after you finished urinating?</legend>
              <div class="optrow" data-q="q1">
                <!-- value 0–5 maps to IPSS scoring -->
              </div>
            </fieldset>

            <!-- Q2 -->
            <fieldset class="q">
              <legend>2) Over the past month, how often have you had to <strong>urinate again less than 2 hours</strong> after you finished urinating?</legend>
              <div class="optrow" data-q="q2"></div>
            </fieldset>

            <!-- Q3 -->
            <fieldset class="q">
              <legend>3) Over the past month, how often have you <strong>stopped and started again several times</strong> when you urinated?</legend>
              <div class="optrow" data-q="q3"></div>
            </fieldset>

            <!-- Q4 -->
            <fieldset class="q">
              <legend>4) Over the past month, how often have you found it <strong>difficult to postpone urination</strong>?</legend>
              <div class="optrow" data-q="q4"></div>
            </fieldset>

            <!-- Q5 -->
            <fieldset class="q">
              <legend>5) Over the past month, how often have you had a <strong>weak urinary stream</strong>?</legend>
              <div class="optrow" data-q="q5"></div>
            </fieldset>

            <!-- Q6 -->
            <fieldset class="q">
              <legend>6) Over the past month, how often have you had to <strong>push or strain</strong> to begin urination?</legend>
              <div class="optrow" data-q="q6"></div>
            </fieldset>

            <!-- Q7 Nocturia (times/night) -->
            <fieldset class="q">
              <legend>7) Over the past month, how many times did you <strong>typically get up at night to urinate</strong> (from bedtime until morning)?</legend>
              <div class="optrow" data-q="q7" data-nocturia="1"></div>
              <div class="muted" style="margin-top:6px;">Scoring: 0 = none, 1 = once, …, 5 = 5 or more times.</div>
            </fieldset>

            <!-- QoL (optional) -->
            <fieldset class="q">
              <legend>Quality of Life (optional): If you were to spend the rest of your life with your urinary condition the way it is now, how would you feel about that?</legend>
              <div class="optrow" data-q="qol" data-qol="1"></div>
              <div class="muted" style="margin-top:6px;">0=Delighted, 1=Pleased, 2=Mostly satisfied, 3=Mixed, 4=Mostly dissatisfied, 5=Unhappy, 6=Terrible.</div>
            </fieldset>

            <label style="display:flex; gap:10px; align-items:flex-start;">
              <input type="checkbox" id="consent" required>
              <span class="muted">I consent to share these responses for research and product improvement. I understand this is not medical advice.</span>
            </label>

            <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
              <button id="submitBtn" type="submit" disabled>Submit assessment</button>
              <div class="muted" id="hint">Enter name & valid email, answer all items, and consent.</div>
            </div>

            <div id="serverMsg" class="msg ok" style="display:none;">✓ Thanks! Your IPSS total is <strong id="serverTotal"></strong>.</div>
            <div id="serverErr" class="msg err" style="display:none;">⚠ <span id="serverErrText"></span></div>
          </form>
        </div>
      </div>

      <!-- VISUALS -->
      <div class="stack">
        <div class="card">
          <div class="card-h">Live Score</div>
          <div class="card-b" style="display:grid; grid-template-columns:180px 1fr; gap:16px; align-items:center;">
            <svg class="gauge" viewBox="0 0 200 200" aria-hidden="true">
              <circle class="g-bg" cx="100" cy="100" r="70"></circle>
              <circle id="gFG" class="g-fg" cx="100" cy="100" r="70"
                      stroke-dasharray="439.82" stroke-dashoffset="439.82"></circle>
            </svg>
            <div>
              <div class="score" id="scoreVal">0</div>
              <div id="sevBadge" class="badge b-emerald">Mild</div>
              <div class="muted" style="margin-top:8px;">International Prostate Symptom Score (0–35)</div>
              <div class="muted" style="margin-top:10px;">
                <strong>How to read:</strong> 0–7 Mild • 8–19 Moderate • 20–35 Severe
              </div>
            </div>
          </div>
        </div>

        <div class="card" id="insightsCard" style="display:none;">
          <div class="card-h">What your score suggests</div>
          <div class="card-b muted">
            <p>Your total score is <strong id="finalScore"></strong>. <span id="finalBadge" class="badge b-emerald">Mild</span></p>
            <ul style="margin:6px 0 0 18px;">
              <li>Mild (0–7): lifestyle changes and monitoring may help.</li>
              <li>Moderate (8–19): consider discussing options with a healthcare professional.</li>
              <li>Severe (20–35): seek medical advice to evaluate therapies.</li>
            </ul>
            <p style="font-size:12px;margin-top:6px;">This tool is informational and not a substitute for medical care.</p>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div class="inner">
        <div>© <span id="yr"></span> Anurag Pande. All rights reserved.</div>
        <div class="muted"><a href="#" style="color:#0ea5e9;text-decoration:none;">Privacy</a> • <a href="#" style="color:#0ea5e9;text-decoration:none;">Terms</a></div>
      </div>
    </footer>
  </div>

<script>
  // === PASTE YOUR APPS SCRIPT WEB APP URL HERE ===
  const ENDPOINT = 'https://script.google.com/macros/s/PASTE_YOUR_WEB_APP_URL/exec';

  // Build option pills per IPSS standard
  const freqOpts = [
    {v:0, t:'Not at all'},
    {v:1, t:'Less than 1 in 5 times'},
    {v:2, t:'Less than half the time'},
    {v:3, t:'About half the time'},
    {v:4, t:'More than half the time'},
    {v:5, t:'Almost always'}
  ];
  const nocturiaOpts = [
    {v:0, t:'0 times'}, {v:1, t:'1 time'}, {v:2, t:'2 times'},
    {v:3, t:'3 times'}, {v:4, t:'4 times'}, {v:5, t:'5 or more times'}
  ];
  const qolOpts = [
    {v:0, t:'0 — Delighted'}, {v:1, t:'1 — Pleased'}, {v:2, t:'2 — Mostly satisfied'},
    {v:3, t:'3 — Mixed'}, {v:4, t:'4 — Mostly dissatisfied'}, {v:5, t:'5 — Unhappy'}, {v:6, t:'6 — Terrible'}
  ];

  function makePills(container, name, opts){
    container.innerHTML = '';
    opts.forEach((o,i) => {
      const id = name + '-' + i;
      const label = document.createElement('label');
      label.className = 'pill';
      label.innerHTML = `<input type="radio" name="${name}" id="${id}" value="${o.v}"><span>${o.t}</span>`;
      container.appendChild(label);
    });
  }

  document.querySelectorAll('.optrow').forEach(row=>{
    const key = row.getAttribute('data-q');
    if (row.hasAttribute('data-nocturia')) makePills(row, key, nocturiaOpts);
    else if (row.hasAttribute('data-qol')) makePills(row, key, qolOpts);
    else makePills(row, key, freqOpts);
  });

  // DOM refs
  const form = document.getElementById('ipssForm');
  const submitBtn = document.getElementById('submitBtn');
  const hint = document.getElementById('hint');
  const gFG = document.getElementById('gFG');
  const scoreVal = document.getElementById('scoreVal');
  const sevBadge = document.getElementById('sevBadge');
  const insights = document.getElementById('insightsCard');
  const finalScore = document.getElementById('finalScore');
  const finalBadge = document.getElementById('finalBadge');
  const serverMsg = document.getElementById('serverMsg');
  const serverTotal = document.getElementById('serverTotal');
  const serverErr = document.getElementById('serverErr');
  const serverErrText = document.getElementById('serverErrText');
  document.getElementById('yr').textContent = new Date().getFullYear();

  // Live gauge
  const CIRC = 2*Math.PI*70;
  gFG.setAttribute('stroke-dasharray', CIRC.toFixed(2));
  gFG.style.strokeDashoffset = CIRC;

  function totalScore(){
    let t = 0;
    for (const k of ['q1','q2','q3','q4','q5','q6','q7']) {
      const sel = form.querySelector(`input[name="${k}"]:checked`);
      if (!sel) return null;
      t += parseInt(sel.value,10);
    }
    return t;
  }
  function severity(t){
    if (t >= 20) return ['Severe','b-rose'];
    if (t >= 8)  return ['Moderate','b-amber'];
    return ['Mild','b-emerald'];
  }
  function updateGauge(){
    const t = totalScore() ?? 0;
    scoreVal.textContent = t;
    const ratio = Math.max(0, Math.min(1, t/35));
    gFG.style.strokeDashoffset = (CIRC*(1-ratio)).toFixed(2);
    const [lab, cls] = severity(t);
    sevBadge.textContent = lab; sevBadge.className = 'badge ' + cls;
  }
  form.addEventListener('input', () => { updateGauge(); validateForm(); });

  function validateForm(){
    const nameOK = (document.getElementById('name').value.trim().length >= 2);
    const emailV = document.getElementById('email').value.trim();
    const emailOK = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailV);
    const allQs = totalScore() !== null; // all 7 answered
    const consent = document.getElementById('consent').checked;
    const ok = nameOK && emailOK && allQs && consent;
    submitBtn.disabled = !ok;
    hint.style.display = ok ? 'none' : 'block';
  }

  // UTM capture
  const usp = new URLSearchParams(location.search);
  const utm = {
    utm_source: usp.get('utm_source') || '',
    utm_medium: usp.get('utm_medium') || '',
    utm_campaign: usp.get('utm_campaign') || '',
    utm_term: usp.get('utm_term') || '',
    utm_content: usp.get('utm_content') || '',
    page_url: location.href
  };

  // Submit
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    serverMsg.style.display='none'; serverErr.style.display='none';
    const prev = submitBtn.textContent; submitBtn.textContent='Submitting…'; submitBtn.disabled = true;

    const fd = new FormData();
    fd.append('name', document.getElementById('name').value.trim());
    fd.append('email', document.getElementById('email').value.trim());
    ['q1','q2','q3','q4','q5','q6','q7'].forEach(k=>{
      const v = form.querySelector(`input[name="${k}"]:checked`).value;
      fd.append(k, v);
    });
    const qolSel = form.querySelector('input[name="qol"]:checked');
    if (qolSel) fd.append('qol', qolSel.value);
    Object.entries(utm).forEach(([k,v])=>fd.append(k,v));

    try {
      const res = await fetch(ENDPOINT, { method:'POST', body:fd });
      const out = await res.json();
      if (out.ok) {
        serverTotal.textContent = out.total;
        serverMsg.style.display='flex';
        finalScore.textContent = out.total;
        const [lab, cls] = severity(out.total || totalScore() || 0);
        finalBadge.textContent = lab; finalBadge.className = 'badge ' + cls;
        insights.style.display='block';
      } else {
        serverErrText.textContent = out.error || 'Submission failed.';
        serverErr.style.display='flex';
      }
    } catch (err) {
      serverErrText.textContent = 'Network error. Check your Apps Script Web App URL & access.';
      serverErr.style.display='flex';
    } finally {
      submitBtn.textContent = prev; validateForm();
    }
  });

  // init
  updateGauge(); validateForm();
</script>
</body>
</html>
